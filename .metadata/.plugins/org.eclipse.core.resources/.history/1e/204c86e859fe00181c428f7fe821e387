package cibertec;

import java.awt.BorderLayout;
import java.awt.FlowLayout;

import javax.swing.JButton;
import javax.swing.JDialog;
import javax.swing.JPanel;
import javax.swing.border.EmptyBorder;
import javax.swing.JLabel;
import javax.swing.JTextField;
import javax.swing.JComboBox;
import javax.swing.DefaultComboBoxModel;
import javax.swing.JScrollPane;
import javax.swing.JTextArea;
import java.awt.event.ActionListener;
import java.awt.event.ActionEvent;

public class Vender extends JDialog implements ActionListener {

	private final JPanel contentPanel = new JPanel();
	private JLabel lblMarca;
	private JTextField txtCantidad;
	private JTextField txtPrecio;
	private JComboBox cboMarca;
	private JTextArea txtS;
	private JButton btnVender;
	private JButton btnCerrar;

	/**
	 * Launch the application.
	 */
	public static void main(String[] args) {
		try {
			Vender dialog = new Vender();
			dialog.setDefaultCloseOperation(JDialog.DISPOSE_ON_CLOSE);
			dialog.setVisible(true);
		}
		catch (Exception e) {
			e.printStackTrace();
		}
	}
	
	public static int nCliente = 0;
	
	public static int cantidadVentasMarca0 = 0;
	public static int cantidadVentasMarca1 = 0;
	public static int cantidadVentasMarca2 = 0;
	public static int cantidadVentasMarca3 = 0;
	public static int cantidadVentasMarca4 = 0;
	
	public static double impAcumuladoMarca0 = 0.0;
	public static double impAcumuladoMarca1 = 0.0;
	public static double impAcumuladoMarca2 = 0.0;
	public static double impAcumuladoMarca3 = 0.0;
	public static double impAcumuladoMarca4 = 0.0;

	/**
	 * Create the dialog.
	 */
	public Vender() {
		setTitle("Vender");
		setBounds(100, 100, 800, 400);
		getContentPane().setLayout(new BorderLayout());
		contentPanel.setBorder(new EmptyBorder(5, 5, 5, 5));
		getContentPane().add(contentPanel, BorderLayout.CENTER);
		contentPanel.setLayout(null);
		
		lblMarca = new JLabel("Marca");
		lblMarca.setBounds(21, 21, 59, 14);
		contentPanel.add(lblMarca);
		{
			JLabel lblPrecio = new JLabel("Precio (S/)");
			lblPrecio.setBounds(21, 60, 77, 14);
			contentPanel.add(lblPrecio);
		}
		{
			JLabel lblCantidad = new JLabel("Cantidad");
			lblCantidad.setBounds(21, 99, 77, 14);
			contentPanel.add(lblCantidad);
		}
		
		txtCantidad = new JTextField();
		txtCantidad.setBounds(121, 96, 86, 20);
		contentPanel.add(txtCantidad);
		txtCantidad.setColumns(10);
		
		txtPrecio = new JTextField();
		txtPrecio.setEditable(false);
		txtPrecio.setBounds(121, 57, 86, 20);
		contentPanel.add(txtPrecio);
		txtPrecio.setColumns(10);
		
		cboMarca = new JComboBox();
		cboMarca.addActionListener(this);
		cboMarca.setModel(new DefaultComboBoxModel(new String[] {"Alfano", "Delicia", "Vimar", "Turok", "Havanna"}));
		cboMarca.setBounds(121, 18, 86, 20);
		contentPanel.add(cboMarca);
		{
			btnVender = new JButton("Vender");
			btnVender.addActionListener(this);
			btnVender.setBounds(638, 17, 111, 23);
			contentPanel.add(btnVender);
		}
		{
			btnCerrar = new JButton("Cerrar");
			btnCerrar.addActionListener(this);
			btnCerrar.setBounds(638, 56, 111, 23);
			contentPanel.add(btnCerrar);
		}
		{
			JScrollPane scrollPane = new JScrollPane();
			scrollPane.setBounds(21, 136, 728, 200);
			contentPanel.add(scrollPane);
			
			txtS = new JTextArea();
			scrollPane.setViewportView(txtS);
		}
	}
	public void actionPerformed(ActionEvent e) {
		if (e.getSource() == btnCerrar) {
			actionPerformedBtnCerrar(e);
		}
		if (e.getSource() == btnVender) {
			actionPerformedBtnVender(e);
		}
		if (e.getSource() == cboMarca) {
			actionPerformedCboMarca(e);
		}
	}
	protected void actionPerformedCboMarca(ActionEvent e) {
		int	posMarca = cboMarca.getSelectedIndex();
		
		switch(posMarca){
			case 0:
				txtPrecio.setText(Tienda.precio0 + "");
				break;
			case 1:
				txtPrecio.setText(Tienda.precio1 + "");
				break;
			case 2:
				txtPrecio.setText(Tienda.precio2 + "");
				break;
			case 3:
				txtPrecio.setText(Tienda.precio3 + "");
				break;
			default:
				txtPrecio.setText(Tienda.precio4 + "");
				break;
		}		
	}
	

	protected void actionPerformedBtnVender(ActionEvent e) {		
		int
			cantidad = Integer.parseInt(txtCantidad.getText()),
			posMarca = cboMarca.getSelectedIndex();
		String marca, obsequio, premioSorpresa;
	
		double precio, importeCompra, descuento, importePagar;
		
		switch(posMarca){
			case 0:
				precio = Tienda.precio0;
				break;
			case 1:
				precio = Tienda.precio1;
				break;
			case 2:
				precio = Tienda.precio2;
				break;
			case 3:
				precio = Tienda.precio3;
				break;
			default:
				precio = Tienda.precio4;
				break;
		}
		
		nCliente++;
		
		marca = cboMarca.getSelectedItem().toString();
		
		importeCompra = precio * cantidad;
		
		if(cantidad <= 5)
			descuento = cantidad * (Tienda.porcentaje1/100);
		else if (cantidad <= 10)
			descuento = cantidad * (Tienda.porcentaje2/100);
		else if (cantidad <= 15)
			descuento = cantidad * (Tienda.porcentaje3/100);
		else
			descuento = cantidad * (Tienda.porcentaje4/100);
	
		importePagar = importeCompra - descuento;
		
		if (cantidad > Tienda.cantidadObsequiable) {
			obsequio = Tienda.obsequio;
		} else {
			obsequio = "Ninguno";
		}
		
		if (nCliente == Tienda.numeroClienteSorpresa)
			premioSorpresa = Tienda.premioSorpresa;
		else
			premioSorpresa = "No";
		
		mostrarBoleta(marca, precio, cantidad, importeCompra, descuento, importePagar, obsequio, premioSorpresa);
		
		switch(posMarca){
			case 0:
				cantidadVentasMarca0++;
				impAcumuladoMarca0+=importePagar;
				break;
			case 1:
				cantidadVentasMarca1++;
				impAcumuladoMarca1+=importePagar;
				break;
			case 2:
				cantidadVentasMarca2++;
				impAcumuladoMarca2+=importePagar;
				break;
			case 3:
				cantidadVentasMarca3++;
				impAcumuladoMarca3+=importePagar;
				break;
			default:
				cantidadVentasMarca4++;
				impAcumuladoMarca4+=importePagar;
				break;
		}
	}
	
	void mostrarBoleta(String marca, double precio, int cantidad, double importeCompra, double descuento, double importePagar, String obsequio, String premioSorpresa) {
		txtS.setText("");
		imprimir("VENTA");
		imprimir("");
		imprimir("Marca de alfajor: " + marca);
		imprimir("Precio unitario: " + precio);
		imprimir("Cantidad de cajas adquiridas: " + cantidad);
		imprimir("Importe de compra: " + importeCompra);
		imprimir("Importe de descuento: " + descuento);
		imprimir("Importe a pagar: " + importePagar);
		imprimir("Obsequio: " + obsequio);
		imprimir("Premio sorpresa: " + premioSorpresa);
		imprimir("Importe acumulado: " + impAcumuladoMarca1);
	}
	
	void imprimir(String s) {
		txtS.append(s + "\n");
	}
	protected void actionPerformedBtnCerrar(ActionEvent e) {
		dispose();
	}
}
